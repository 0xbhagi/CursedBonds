const Web3 = require('web3');
const contractAbi = [{"inputs":[{"internalType":"bool","name":"exists","type":"bool"},{"internalType":"address","name":"archaeologist","type":"address"}],"name":"ArchaeologistProfileExistsShouldBe","type":"error"},{"inputs":[{"internalType":"bytes32","name":"sarcoId","type":"bytes32"}],"name":"SarcophagusDoesNotExist","type":"error"},{"inputs":[{"internalType":"address","name":"archaeologist","type":"address"}],"name":"getArchaeologistProfile","outputs":[{"components":[{"internalType":"uint256","name":"maximumRewrapInterval","type":"uint256"},{"internalType":"uint256","name":"maximumResurrectionTime","type":"uint256"},{"internalType":"string","name":"peerId","type":"string"},{"internalType":"uint256","name":"minimumDiggingFeePerSecond","type":"uint256"},{"internalType":"uint256","name":"freeBond","type":"uint256"},{"internalType":"uint256","name":"cursedBond","type":"uint256"},{"internalType":"uint256","name":"curseFee","type":"uint256"}],"internalType":"struct LibTypes.ArchaeologistProfile","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"index","type":"uint256"}],"name":"getArchaeologistProfileAddressAtIndex","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getArchaeologistProfileAddresses","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address[]","name":"addresses","type":"address[]"}],"name":"getArchaeologistProfiles","outputs":[{"components":[{"internalType":"uint256","name":"maximumRewrapInterval","type":"uint256"},{"internalType":"uint256","name":"maximumResurrectionTime","type":"uint256"},{"internalType":"string","name":"peerId","type":"string"},{"internalType":"uint256","name":"minimumDiggingFeePerSecond","type":"uint256"},{"internalType":"uint256","name":"freeBond","type":"uint256"},{"internalType":"uint256","name":"cursedBond","type":"uint256"},{"internalType":"uint256","name":"curseFee","type":"uint256"}],"internalType":"struct LibTypes.ArchaeologistProfile[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"archaeologist","type":"address"}],"name":"getArchaeologistSarcophagi","outputs":[{"internalType":"bytes32[]","name":"","type":"bytes32[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"archaeologist","type":"address"}],"name":"getCursedBond","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getCursedBondPercentage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getEmbalmerClaimWindow","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"embalmer","type":"address"}],"name":"getEmbalmerSarcophagi","outputs":[{"internalType":"bytes32[]","name":"","type":"bytes32[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getExpirationThreshold","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"archaeologist","type":"address"}],"name":"getFreeBond","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getGracePeriod","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getProtocolFeeBasePercentage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"recipient","type":"address"}],"name":"getRecipientSarcophagi","outputs":[{"internalType":"bytes32[]","name":"","type":"bytes32[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"archaeologist","type":"address"}],"name":"getRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"sarcoId","type":"bytes32"}],"name":"getSarcophagus","outputs":[{"components":[{"internalType":"uint256","name":"resurrectionTime","type":"uint256"},{"internalType":"uint256","name":"previousRewrapTime","type":"uint256"},{"internalType":"bool","name":"isCompromised","type":"bool"},{"internalType":"bool","name":"isCleaned","type":"bool"},{"internalType":"string","name":"name","type":"string"},{"internalType":"uint8","name":"threshold","type":"uint8"},{"internalType":"uint256","name":"maximumRewrapInterval","type":"uint256"},{"internalType":"uint256","name":"maximumResurrectionTime","type":"uint256"},{"internalType":"uint256","name":"cursedBondPercentage","type":"uint256"},{"internalType":"string","name":"arweaveTxId","type":"string"},{"internalType":"address","name":"embalmerAddress","type":"address"},{"internalType":"address","name":"recipientAddress","type":"address"},{"internalType":"address[]","name":"archaeologistAddresses","type":"address[]"},{"internalType":"uint8","name":"publishedPrivateKeyCount","type":"uint8"},{"internalType":"bool","name":"hasLockedBond","type":"bool"}],"internalType":"struct ViewStateFacet.SarcophagusResponse","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"sarcoId","type":"bytes32"},{"internalType":"address","name":"archaeologist","type":"address"}],"name":"getSarcophagusArchaeologist","outputs":[{"components":[{"internalType":"uint256","name":"diggingFeePerSecond","type":"uint256"},{"internalType":"bytes32","name":"privateKey","type":"bytes32"},{"internalType":"bytes","name":"publicKey","type":"bytes"},{"internalType":"bool","name":"isAccused","type":"bool"},{"internalType":"uint256","name":"curseFee","type":"uint256"}],"internalType":"struct LibTypes.CursedArchaeologist","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getTotalProtocolFees","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}]
const infuraUrl = 'https://rpc.ankr.com/eth_goerli'; 
const web3 = new Web3(infuraUrl);
const contractAddress  = '0x6b84f17bbfce26776fefdf5cf039ca0e66c46caf'; 

const contract = new web3.eth.Contract(contractAbi, contractAddress);

  contract.methods.getArchaeologistProfileAddresses().call()
  .then(getCursedBonds)
  .catch(error => {
    console.error('Error:', error);
  });

  function getCursedBonds(addresses) {
    const cursedBondPromises = addresses.map(address => {
      return contract.methods.getCursedBond(address).call();
    });
  
    Promise.all(cursedBondPromises)
      .then(cursedBonds => {
        const totalCursedBond = cursedBonds.reduce((accumulator, currentValue) => {
          return accumulator + Number(currentValue);
        }, 0);
        
        console.log('Total Cursed Bond:', totalCursedBond/1e18);
      })
      .catch(error => {
        console.error('Error:', error);
      });
  }
  

